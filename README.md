# 과제 7
## 폰클래스를 이용하여 캐릭터 구현하기

## 필수 과제
1.  C++ Pawn 클래스와 충돌 컴포넌트 구성 ㅇ 
2.  Enhanced Input 매핑 & 바인딩 ㅇ 


## 도전 과제
1.  6자유도 (6 DOF) 드론/비행체 구현 (난이도 상) ㅁ ( 드론 처럼 느껴지지 않고 비행기 처럼 되어버림)
2.  중력 및 낙하 구현 (난이도 최상) ㅇ 

## 키 

기본
wasd 이동 
스페이스바 점프

드론 
w 이동
qead 방향 회전

공통 
p 폰 전환



## 방법 구상

1. c++ 폰클래스  생성 후 그곳에 컴포넌트 적어주기. ㅇ
2. 스프링암 카메라 연결 해주기 ㅇ
3. c++ 게임 모드 생성후 기본 클래스 지정해주기 ㅇ
4. IMC, IA 만들어주고 게임모드에 지정해주기 (플레이어 컨트롤러에서 지정함 ㅇ  )
5. IA에 함수 넣어주기 ㅇ
6. 드론같은 경우는 gta5 참고

## 도전 과제와 연결 구상

1 - 1. 드론 비행체 IMC를 따로 구현해서 캐릭터 변경시 IMC를 바꿔주기 
1 - 2. IMC는 그대로 두고 함수만 바꿔주기 
개인적으로는 1-1번이 좋아보인다.
이유 : 설명이 부족하다 드론은 다방면으로 움직일 수 있으니까 vector3을 줘야 할것같은데
그냥 vector2로 앞뒤 좌우 움직이고 qe로 위아래 조절 가능 하기때문
일반 캐릭터에게 불필요한 qe를 주는 방식 혹은 imc를 새로 만들어서 더많이 생성하는 방향
으로 정해질 것 같다.

2 - 1 . IMC와 그에 맞는 IA를 여러개 만들어서 PlayerController에 넣어준다.
2 - 2 . 하나의 IMC를 담은 PlayerController를  여러개 만들어준다.
이지선다 
플레이어 컨트롤러에 IMC와 IA를 많이 받는 방법과
게임모드에서 플레이어 컨트롤러를 찾는방식 
찾는것보다는 지정이 가능한 방식이 더 나을 듯하다

3 - 1 . 드론 캐릭터 플레이어 캐릭터 따로 만들어 두기만 하기
3 - 2 . 드론 캐릭터 플레이어 캐릭터 따로 만들되 키를 입력받으면 해당 캐릭터로 변경 

4 . 드론을 움직일때 마우스 회전으로 캐릭터 구경은 가능하게해주고 좌 우 누를 시 메쉬의 yaw이 회전하고 정면으로 만 이동하게 해주기
   그리고 q e 를 사용하여 위 아래 방향 정하기

5. 중력적용할때 시도하려했던 폰의 가속도로 움직이기 이제는 구현 가능 할 것 같다
   Tick 에서 가속도에 * 0.n씩 하던가 아니면 -n 을 해서 가속도를 0까지 줄이면 될 것 같다.


## 플레이어 컨트롤러
InputMappingContext와 InputAction이 담겨있다.
UInputMappingContext , UInputAction

시작시 
로컬플레이어 지정후 현재 해당하는 IMC ,IA값들을 로컬플레이어에게 전달하는 코드 작성


## 폰 

폰에서 SetupPlayerInputComponent 함수에서 Input정해주기

## 게임 모드
캐릭터와 , 컨트롤러 정해주기


### 공부내용 1 플레이어 컨트롤러 우선순위
플레이어 컨트롤러에서 InputMappingContext를 우선순위로 정해준다는걸 다시 복습하게되었다
여기서 든 생각은 만약 공격도중 이동 불가능 하게 하고싶으면 공격 매핑 이 0순위 이동 매핑이 1순위면
공격 도중에는 이동이 안되지 않을가? 싶다.

### 공부내용 2 움직이는 방식

아마도 움직이는 방식 배울때 배운 것 같지만 잊었으므로 다시 정리

 SetActorLocation : 액터를 "월드"좌표로 움직이기 ( 해당 위치로 이동)
 AddActorLocalOffset : 액터를 "로컬"좌표로 움직이기 ( 현재 위치에서 더하기)


### 겪은 문제들
1. 아직 함수를 외우지 못한건지 몰라도 할때마다 무슨 함수써야되는지 방식은 뭔지 시간이 걸렸다.
   해결방법생각: 외우지 못하더라도 내가 사용한 코드들 정리해둬서 필요할때 마다 찾아써보기
   이유: 자주 사용하는 코드는 외워질지라도 잠시 다른 분야에서 코드 하다보면 그 분야의 코드는 까먹을 걸 예상

2. 해당 클래스 , 구조체 ,함수 등이 어느 헤더 파일인건지 알 수 없음 
  여기서는 좀 문제였던게 이름을 틀리거나 하면 찾기 더힘들어 질뿐더러
   1번과 곂치는 부분인 "모르는데 어떻게해요?" 가 나와버렸다. 인터넷에 다른 사람들 코드를 분석하던가
  아니면 해당 클래스를 모아놓고 "설명"해놓은 책을 구하는방법?
   언리얼 문서에서는 클래스등이 나열되어있긴한데 직접 클릭해서확인하지않으면 무슨 함수인건지 정확하게 알 수 없다.

3. 중력 작용하는 과정에서 너무 빠르게 떨어지는 과정 발생 너무 빠르다보니 중력으로 느껴지지않음.
   뭔가 움직이는것을 한곳에서 몰아서 해야겠다 .여러곳에서 하니 뒤죽박죽이 되는거같다.

4. 한곳에서 이동속도를 관리하므로 현재 받은 모든 FVector를 현재 Location에서 부터 FVector까지 부드럽게 움직일 수 있도록
   FMath::Lerp를 사용함. 문제는 여기서 발생 의도는 좋았으나 너무 느리거나 너무 빨라지게 됨.

5. 아무키도 안눌릴때 발동할 함수를 만들었는데 알고보니 키를 눌러야만 작동하는 함수에 작성하는 선택을 해버렸다. 그래서 Completed를 사용했다. ㅇ 

6. 흐음 공중에서 움직일때 느리게 하는건 되었지만 점프 같지 않고 어색하다
   그렇다면 점프 할때 해당 방향으로 가속도가 있어야되는데 
   가속도 정해줘서 해결 완료 및 문제 발생

7. 점프 했을때 회전 하면 회전 한방향으로 이동이 됨 즉 '정면으로 달리면서 점프하고 공중에서 좌측으로 회전하면 좌측으로 이동이된다'
   AadActorLocalOffset으로 현재 로컬 방향으로 움직인다는 조건 때문에 공중에서 방향 바꾸었을때 아니지 FVector::Forward사용해서 이동 할때 정면으로 이동 하려하는 것 같다.
그래서 점프시 이동은 SetActorLocation으로 "월드"좌표로 움직이게 하여 회전 하지 않게 했다 (GetActorLocation() 더해주지 않아서 순간 당황했다.)
여기서 또 문제 발생

8. 캐릭터 정반대로 회전 후 점프를 했을시 반대로 점프가 된다??(정면 에서 점프시 뒤로) (좌측으로 점프시 우측으로)
   이유는 역시 setactorlocation이다 회전해도 "월드"좌표로 움직이게 한 것이 문제다..

9. 매우 많은 시도 끝에 회전 후에도 점프 했을시 그방향으로 움직인다!! GetActorForwardVector()를 이용했더니 되었다
    대신 뒤로 돌아서 움직였을 때 반대 방향으로 움직였다 생각해보니 가속도 를 FVector::Forward방식에서 GetActorFowardVector로 바꾸었으니 값이 바뀌었을 텐데 여기서       offset을 해주니 값이 이상했을 것이다 180도 회전 한상태에서 정면은 -1일테니 -1을 offset해준거나 마찬가지 였을테니 움직임이 변햇을것이다
   그래서 setactorlocation을 사용해서 움직이는 걸로 결론 내렸다.

10. 기본형 폰을 만든후 드론 폰을 만드려하는데 고민이 생겼다
  
10 - 1.  플레리어 컨트롤러안에 여러 IMC를 둔다

10 - 2.  한개의 IMC를 가진 여러 플레이어 컨트롤러를 둔다.

나는 1번을 선택하려 했다 이유는 처음에 IA를 추가로 만드려고 했다. 그런데 IA기능이 똑같은걸 굳이 그래야 할 필요가 있나 싶어서
 생각하다보니 IMC에서 IA의 키를 지정해주는 것 뿐이니 IA는 많이 만들 필요가 없어보였다..?
 (여러 IMC에서 같은 IA를 사용할경우 충돌 할까 걱정 되었는데 IA자체는 값타입 트리거 모디파이어 등 을 가지고 있는거고 IMC에서는 그걸 사용할 뿐 우선순위에 따라 사용되는 것이였다)


11. IMC에서 wasd에 스케일 값을 적용해봤는데 wasd전부 1 혹은 -1로 설정 해놓은 것뿐인데 알아서 Moveinput.x와 y에 입력값이 되었다
   어째서 wasd가 각각 x와 y의 값으로 자동 적용 되는지 모르겠다
   스위즐 축값도 아직이해가 안되지만 공통점으로 x, y , z중 앞에 있는 값으로 적용된다 (x, y , z 중 앞에 있는게 해당인풋 값)

 
### 생각 나는 점 
코드함수를 모르니까 이 코드를 사용해서 이렇게 만들겠다가 아닌
나는 뭘 만들고 싶고,
만약 만든다면 이러한 조건들이 있을거고
를 생각하면서 거기서 살을 붙이는 방식으로 가는 게 어떤가 싶었다.

### 액터의 로컬 좌표 월드 좌표

이번에 과제를 해보면서 객체를 움직이는 방식이 로컬좌표 전용인건지 월드 좌표 전용인건지 부딪히면서 알게되었다.
FVector:: 처럼 월드좌표기준 혹은 기본 벡터값을 주는 것도 있고
GetActorForward() 처럼 로컬 좌표 기준 방향 벡터 값을 주는 것도 있고
SetActorLocation() 처럼 월드 좌표로 움직이기
AddActorLocalOffset() 처럼 좌표에 더해줘서 움직이는 것도 있고

움직이게 해주는 함수종류는 내가 아는것보다 훨씬 많은데 전부 약간 씩 다른 점이 있다는 게 어지러웠다.


### 빌드 오류 중 하나
1. 함수를 헤더파일만 지정해놓고 빌드하면오류남 소스파일도 같이해줘야됨.


### 스스로 코드 보면서 느낀점

1. 함수에서 불필요한 코드가 적혀있는 경우가 보였다.
   팀프로젝트할 때 봤던 팀원분의 코드에서는 하나의 함수안에 여러개의 역할을 두지 않으려 했단게 보였는데
   이번에 팀프로젝트 이후 해보는 과제에서 함수에 여러 역할이 보인다.

2. 언리얼 함수들을 아직도 익숙해지지 못했다 아직 함수이름을 기억 못했다.

3. 코드를 작성후 분석 , 복습 보다는 바로 다음 문제를 해결 하려는 모습을 보였다.

4. 어렵거나 막히는코드를 해결하다보면 예전 보던 코드의 존재를 잊어버리는 것같다.
